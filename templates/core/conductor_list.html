{% extends 'base.html' %}

{% block title %}Conductores - Sistema de Gestión de Flota{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        margin-bottom: 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .page-header h1 {
        margin: 0;
        display: flex;
        align-items: center;
        gap: 1rem;
        color: var(--primary-color);
    }

    .empty-state {
        text-align: center;
        padding: 3rem 2rem;
    }

    .empty-state i {
        color: #d1d5db;
        margin-bottom: 1rem;
    }

    .search-filter-section {
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
    }

    .search-box {
        position: relative;
    }

    .search-box .search-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
    }

    .search-box input {
        padding-left: 40px;
    }

    .filter-section {
        display: flex;
        gap: 1rem;
        align-items: end;
    }

    .pagination {
        justify-content: center;
        margin-top: 2rem;
    }

    .pagination .page-link {
        color: #0d47a1;
        border-color: #dee2e6;
    }

    .pagination .page-item.active .page-link {
        background-color: #0d47a1;
        border-color: #0d47a1;
    }

    .pagination .page-link:hover {
        background-color: #e3f2fd;
        color: #0d47a1;
    }

    .results-info {
        color: #6c757d;
        font-size: 0.9rem;
        margin-bottom: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2><i class="fas fa-user-tie me-2"></i>Conductores</h2>
    <div class="d-flex gap-2">
        <button class="btn btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#searchFilters" aria-expanded="false" aria-controls="searchFilters">
            <i class="fas fa-filter me-2"></i>Búsqueda y Filtros
        </button>
        <a href="{% url 'conductor_create' %}" class="btn btn-create">
            <i class="fas fa-plus me-2"></i>Crear Nuevo Conductor
        </a>
    </div>
</div>

<!-- Sección de Búsqueda y Filtros -->
<div class="collapse {% if search or estado or licencia %}show{% endif %}" id="searchFilters">
    <div class="search-filter-section">
        <form method="get" id="filterForm">
        <div class="row mb-3">
            <div class="col-md-12">
                <label class="form-label"><i class="fas fa-search me-2"></i>Buscar</label>
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" 
                           class="form-control" 
                           name="search" 
                           value="{{ search }}" 
                           placeholder="Buscar por nombre, apellido, cédula, email o teléfono...">
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-3">
                <label class="form-label"><i class="fas fa-filter me-2"></i>Estado</label>
                <select class="form-select" name="estado">
                    <option value="">Todos</option>
                    <option value="activo" {% if estado == 'activo' %}selected{% endif %}>Activo</option>
                    <option value="inactivo" {% if estado == 'inactivo' %}selected{% endif %}>Inactivo</option>
                </select>
            </div>
            
            <div class="col-md-3">
                <label class="form-label"><i class="fas fa-id-card me-2"></i>Licencia</label>
                <select class="form-select" name="licencia">
                    <option value="">Todas las licencias</option>
                    {% for lic in licencias_opciones %}
                        <option value="{{ lic.codigo }}" {% if licencia == lic.codigo %}selected{% endif %}>
                            {{ lic.nombre }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="col-md-3">
                <label class="form-label"><i class="fas fa-sort me-2"></i>Ordenar por</label>
                <select class="form-select" name="orden">
                    <option value="-creado_en" {% if orden == '-creado_en' %}selected{% endif %}>Más recientes</option>
                    <option value="creado_en" {% if orden == 'creado_en' %}selected{% endif %}>Más antiguos</option>
                    <option value="nombre" {% if orden == 'nombre' %}selected{% endif %}>Nombre (A-Z)</option>
                    <option value="-nombre" {% if orden == '-nombre' %}selected{% endif %}>Nombre (Z-A)</option>
                    <option value="apellido" {% if orden == 'apellido' %}selected{% endif %}>Apellido (A-Z)</option>
                    <option value="-apellido" {% if orden == '-apellido' %}selected{% endif %}>Apellido (Z-A)</option>
                </select>
            </div>
            
            <div class="col-md-3">
                <label class="form-label">&nbsp;</label>
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary flex-grow-1">
                        <i class="fas fa-search me-2"></i>Buscar
                    </button>
                    <a href="{% url 'conductor_list' %}" class="btn btn-secondary">
                        <i class="fas fa-redo"></i>
                    </a>
                </div>
            </div>
        </div>
    </form>
    </div>
</div>

<!-- Información de resultados -->
{% if conductores %}
    <div class="results-info">
        <i class="fas fa-info-circle me-1"></i>
        Mostrando 
        {% if page_obj.has_previous %}
            {{ page_obj.start_index }}
        {% else %}
            1
        {% endif %}
        - 
        {% if page_obj.has_next %}
            {{ page_obj.end_index }}
        {% else %}
            {{ page_obj.paginator.count }}
        {% endif %}
        de {{ page_obj.paginator.count }} conductor{{ page_obj.paginator.count|pluralize:"es" }}
    </div>

    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr style="background-color: #0d47a1; color: #fff;">
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>RUT/Cédula</th>
                    <th>Correo</th>
                    <th>Teléfono</th>
                    <th>Licencias</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for item in conductores_list %}
                <tr>
                    <td><strong>{{ item.obj.nombre }}</strong></td>
                    <td>{{ item.obj.apellido }}</td>
                    <td><span class="badge bg-info">{{ item.obj.cedula }}</span></td>
                    <td>{{ item.obj.email }}</td>
                    <td>{{ item.obj.telefono }}</td>
                    <td>
                        {% if item.licencias_list %}
                            {% for lic in item.licencias_list %}
                                <span class="badge bg-primary me-1">{{ lic.codigo }}</span>
                            {% endfor %}
                        {% else %}
                            <span class="badge bg-secondary">No asignado</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if item.obj.activo %}
                            <span class="badge bg-success">ACTIVO</span>
                        {% else %}
                            <span class="badge bg-warning text-dark">INACTIVO</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'conductor_detail' item.obj.pk %}" class="btn btn-action btn-details" title="Ver Detalles" style="background-color: #2196f3; color: #fff;">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="{% url 'conductor_update' item.obj.pk %}" class="btn btn-action btn-edit" title="Editar" style="background-color: #ffc107; color: #fff;">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{% url 'conductor_delete' item.obj.pk %}" class="btn btn-action btn-delete" title="Eliminar" style="background-color: #f44336; color: #fff;">
                            <i class="fas fa-trash"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Paginación -->
    {% if page_obj.paginator.num_pages > 1 %}
    <nav aria-label="Paginación de conductores">
        <ul class="pagination">
            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page=1{% if search %}&search={{ search }}{% endif %}{% if estado %}&estado={{ estado }}{% endif %}{% if licencia %}&licencia={{ licencia }}{% endif %}{% if orden %}&orden={{ orden }}{% endif %}" aria-label="Primera">
                        <span aria-hidden="true">&laquo;&laquo;</span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search %}&search={{ search }}{% endif %}{% if estado %}&estado={{ estado }}{% endif %}{% if licencia %}&licencia={{ licencia }}{% endif %}{% if orden %}&orden={{ orden }}{% endif %}" aria-label="Anterior">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                    <li class="page-item active">
                        <span class="page-link">{{ num }}</span>
                    </li>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ num }}{% if search %}&search={{ search }}{% endif %}{% if estado %}&estado={{ estado }}{% endif %}{% if licencia %}&licencia={{ licencia }}{% endif %}{% if orden %}&orden={{ orden }}{% endif %}">{{ num }}</a>
                    </li>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search %}&search={{ search }}{% endif %}{% if estado %}&estado={{ estado }}{% endif %}{% if licencia %}&licencia={{ licencia }}{% endif %}{% if orden %}&orden={{ orden }}{% endif %}" aria-label="Siguiente">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if search %}&search={{ search }}{% endif %}{% if estado %}&estado={{ estado }}{% endif %}{% if licencia %}&licencia={{ licencia }}{% endif %}{% if orden %}&orden={{ orden }}{% endif %}" aria-label="Última">
                        <span aria-hidden="true">&raquo;&raquo;</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}

{% else %}
    <div class="text-center py-5">
        <i class="fas fa-user-slash fa-3x text-muted mb-3"></i>
        {% if search or estado or licencia %}
            <h4 class="text-muted">No se encontraron conductores</h4>
            <p class="text-muted">Intenta ajustar los criterios de búsqueda o filtros</p>
            <a href="{% url 'conductor_list' %}" class="btn btn-secondary">
                <i class="fas fa-redo me-2"></i>Limpiar filtros
            </a>
        {% else %}
            <h4 class="text-muted">No hay conductores registrados</h4>
            <p class="text-muted">Comienza agregando tu primer conductor al sistema</p>
            <a href="{% url 'conductor_create' %}" class="btn btn-create">
                <i class="fas fa-plus me-2"></i>Crear Nuevo Conductor
            </a>
        {% endif %}
    </div>
{% endif %}
{% endblock %}